name: atp_tennis_insights
description: |
  Semantic model for ATP tennis match data, including match statistics, player information, and tournament details. Enables natural language queries about tennis matches, player performance, and tournament analytics.
tables:
  - name: matches
    description: |
      The matches table contains detailed information about each tennis match, including tournament details, match results, and player statistics for both winner and loser.
    base_table:
      database: ATP_INSIGHTS
      schema: DEFAULT
      table: MATCHES_SAMPLE_100_ENRICHED
    dimensions:
      - name: loser_entry
        synonyms:
          - loser entry type
        description: |
          Full name of the loser's entry
        expr: matches.loser_entry
        data_type: TEXT
        unique: false
        sample_values:
          - Wild Card
          - Qualifier
          - Lucky Loser
          - Protected Rating
      - name: loser_id
        synonyms:
          - loser
          - loser player id
          - losing player
        description: Unique identifier for the losing player
        expr: matches.loser_id
        data_type: TEXT
        unique: false
      - name: match_round
        synonyms:
          - match round
          - round
          - stage
        description: Round of the tournament (e.g., F, SF, QF, R32)
        expr: matches.match_round
        data_type: TEXT
        unique: false
        sample_values:
          - F
          - SF
          - QF
          - R32
          - R16
          - R64
      - name: tournament_level
        synonyms:
          - event level
          - tour level
          - tournament level
        description: |
          Level of the tournament
        expr: matches.tournament_level
        data_type: TEXT
        unique: false
        sample_values:
          - Grand Slam
          - Masters
          - ATP Tour
          - Futures
      - name: tournament_name
        synonyms:
          - event
          - event name
          - tournament
          - tournament name
        description: Name of the tennis tournament
        expr: matches.tournament_name
        data_type: TEXT
        unique: false
      - name: tournament_surface
        synonyms:
          - court surface
          - playing surface
          - surface
        description: Type of court surface (Hard, Clay, Grass, Carpet)
        expr: matches.tournament_surface
        data_type: TEXT
        unique: false
        sample_values:
          - Hard
          - Clay
          - Grass
          - Carpet
      - name: winner_entry
        synonyms:
          - winner entry type
        description: Entry type code for the winner
        expr: matches.winner_entry
        data_type: TEXT
        unique: false
        sample_values:
          - Wild Card
          - Qualifier
          - Lucky Loser
          - Protected Rating
      - name: winner_id
        synonyms:
          - winner
          - winner player id
          - winning player
        description: Unique identifier for the winning player
        expr: matches.winner_id
        data_type: TEXT
        unique: false
    time_dimensions:
      - name: match_date
        synonyms:
          - date
          - match date
          - when
        description: Date when the match was played
        expr: matches.match_date
        data_type: DATE
        unique: false
    facts:
      - name: loser_aces
        synonyms:
          - aces by loser
          - loser aces
        description: Number of aces served by the loser
        expr: matches.loser_aces
        data_type: NUMBER
      - name: loser_age
        synonyms:
          - loser age
          - losing player age
        description: Age of the loser at the time of the match
        expr: matches.loser_age
        data_type: NUMBER
      - name: loser_break_points_faced
        synonyms:
          - break points faced by loser
          - loser break points faced
        description: Number of break points faced by the loser
        expr: matches.loser_break_points_faced
        data_type: NUMBER
      - name: loser_break_points_saved
        synonyms:
          - break points saved by loser
          - loser break points saved
        description: Number of break points saved by the loser
        expr: matches.loser_break_points_saved
        data_type: NUMBER
      - name: loser_double_faults
        synonyms:
          - double faults by loser
          - loser double faults
        description: Number of double faults by the loser
        expr: matches.loser_double_faults
        data_type: NUMBER
      - name: loser_first_serve_points_won
        synonyms:
          - first serve points won by loser
          - loser first serve points won
        description: Points won on first serve by the loser
        expr: matches.loser_first_serve_points_won
        data_type: NUMBER
      - name: loser_first_serves_in
        synonyms:
          - first serves made by loser
          - loser first serves in
        description: Number of first serves that landed in by the loser
        expr: matches.loser_first_serves_in
        data_type: NUMBER
      - name: loser_rank
        synonyms:
          - loser rank
          - losing player rank
        description: ATP ranking of the loser
        expr: matches.loser_rank
        data_type: NUMBER
      - name: loser_rank_points
        synonyms:
          - loser rank points
          - losing player points
        description: ATP ranking points of the loser
        expr: matches.loser_rank_points
        data_type: NUMBER
      - name: loser_second_serve_points_won
        synonyms:
          - loser second serve points won
          - second serve points won by loser
        description: Points won on second serve by the loser
        expr: matches.loser_second_serve_points_won
        data_type: NUMBER
      - name: loser_seed
        synonyms:
          - loser seed
          - losing player seed
        description: Seeding position of the loser
        expr: matches.loser_seed
        data_type: NUMBER
      - name: loser_service_games
        synonyms:
          - loser service games
          - service games by loser
        description: Number of service games played by the loser
        expr: matches.loser_service_games
        data_type: NUMBER
      - name: loser_service_points
        synonyms:
          - loser service points
          - total service points loser
        description: Total service points played by the loser
        expr: matches.loser_service_points
        data_type: NUMBER
      - name: match_duration_minutes
        synonyms:
          - duration
          - match duration
          - match length
        description: Duration of the match in minutes
        expr: matches.match_duration_minutes
        data_type: NUMBER
      - name: match_score
        synonyms:
          - final score
          - score
        description: Final score of the match
        expr: matches.match_score
        data_type: TEXT
      - name: tournament_best_of_sets
        synonyms:
          - best of sets
          - sets format
        description: Number of sets format (3 or 5)
        expr: matches.tournament_best_of_sets
        data_type: NUMBER
      - name: tournament_draw_size
        synonyms:
          - draw size
          - tournament size
        description: Number of players in the tournament draw
        expr: matches.tournament_draw_size
        data_type: NUMBER
      - name: winner_aces
        synonyms:
          - aces by winner
          - winner aces
        description: Number of aces served by the winner
        expr: matches.winner_aces
        data_type: NUMBER
      - name: winner_age
        synonyms:
          - winner age
          - winning player age
        description: Age of the winner at the time of the match
        expr: matches.winner_age
        data_type: NUMBER
      - name: winner_break_points_faced
        synonyms:
          - break points faced by winner
          - winner break points faced
        description: Number of break points faced by the winner
        expr: matches.winner_break_points_faced
        data_type: NUMBER
      - name: winner_break_points_saved
        synonyms:
          - break points saved by winner
          - winner break points saved
        description: Number of break points saved by the winner
        expr: matches.winner_break_points_saved
        data_type: NUMBER
      - name: winner_double_faults
        synonyms:
          - double faults by winner
          - winner double faults
        description: Number of double faults by the winner
        expr: matches.winner_double_faults
        data_type: NUMBER
      - name: winner_first_serve_points_won
        synonyms:
          - first serve points won by winner
          - winner first serve points won
        description: Points won on first serve by the winner
        expr: matches.winner_first_serve_points_won
        data_type: NUMBER
      - name: winner_first_serves_in
        synonyms:
          - first serves made by winner
          - winner first serves in
        description: Number of first serves that landed in by the winner
        expr: matches.winner_first_serves_in
        data_type: NUMBER
      - name: winner_rank
        synonyms:
          - winner rank
          - winning player rank
        description: ATP ranking of the winner
        expr: matches.winner_rank
        data_type: NUMBER
      - name: winner_rank_points
        synonyms:
          - winner rank points
          - winning player points
        description: ATP ranking points of the winner
        expr: matches.winner_rank_points
        data_type: NUMBER
      - name: winner_second_serve_points_won
        synonyms:
          - second serve points won by winner
          - winner second serve points won
        description: Points won on second serve by the winner
        expr: matches.winner_second_serve_points_won
        data_type: NUMBER
      - name: winner_seed
        synonyms:
          - winner seed
          - winning player seed
        description: Seeding position of the winner in the tournament
        expr: matches.winner_seed
        data_type: NUMBER
      - name: winner_service_games
        synonyms:
          - service games by winner
          - winner service games
        description: Number of service games played by the winner
        expr: matches.winner_service_games
        data_type: NUMBER
      - name: winner_service_points
        synonyms:
          - total service points winner
          - winner service points
        description: Total service points played by the winner
        expr: matches.winner_service_points
        data_type: NUMBER
    filters:
      - name: clay_court_matches
        synonyms:
          - clay court
          - clay surface
        description: Filter to restrict data to clay court matches
        expr: matches.tournament_surface = 'Clay'
      - name: final_round_matches
        synonyms:
          - championship matches
          - finals
        description: Filter to restrict data to final round matches
        expr: matches.match_round = 'F'
      - name: grand_slam_matches
        synonyms:
          - grand slam
          - major tournaments
        description: Filter to restrict data to Grand Slam tournaments
        expr: matches.tournament_level = 'G'
      - name: grass_court_matches
        synonyms:
          - grass court
          - grass surface
        description: Filter to restrict data to grass court matches
        expr: matches.tournament_surface = 'Grass'
      - name: hard_court_matches
        synonyms:
          - hard court
          - hard surface
        description: Filter to restrict data to hard court matches
        expr: matches.tournament_surface = 'Hard'
    metrics:
      - name: average_aces_in_long_matches
        synonyms:
          - aces in extended matches
          - aces in long matches
        description: Average aces in matches longer than 2 hours
        expr: AVG(CASE WHEN matches.match_duration_minutes > 120 THEN matches.winner_aces + matches.loser_aces ELSE NULL END)
      - name: average_aces_per_match
        synonyms:
          - aces per match
          - average aces
          - avg aces per match
        description: Average number of aces per match
        expr: AVG(matches.winner_aces + matches.loser_aces)
      - name: average_age_difference
        synonyms:
          - average age difference
          - avg age gap
          - generation gap
        description: Average absolute age difference between players
        expr: AVG(CASE WHEN matches.winner_age IS NOT NULL AND matches.loser_age IS NOT NULL THEN ABS(matches.winner_age - matches.loser_age) ELSE NULL END)
      - name: average_break_points_in_long_matches
        synonyms:
          - break points in extended matches
          - break points in long matches
        description: Average break points faced in matches longer than 2 hours
        expr: AVG(CASE WHEN matches.match_duration_minutes > 120 THEN matches.winner_break_points_faced + matches.loser_break_points_faced ELSE NULL END)
      - name: average_clutch_performance
        synonyms:
          - break point performance
          - clutch performance
          - pressure performance
        description: Average break point conversion rate in high-pressure situations
        expr: AVG(CASE WHEN (matches.winner_break_points_faced + matches.loser_break_points_faced) > 10 THEN ((matches.loser_break_points_faced - matches.loser_break_points_saved + matches.winner_break_points_faced - matches.winner_break_points_saved)::FLOAT / (matches.winner_break_points_faced + matches.loser_break_points_faced)) * 100 ELSE NULL END)
      - name: average_double_faults_per_match
        synonyms:
          - average double faults
          - avg double faults per match
          - double faults per match
        description: Average number of double faults per match
        expr: AVG(matches.winner_double_faults + matches.loser_double_faults)
      - name: average_first_serve_percentage
        synonyms:
          - average first serve percentage
          - avg first serve %
          - first serve accuracy
        description: Average first serve percentage across all players (winners and losers)
        expr: AVG((matches.winner_first_serve_percentage + matches.loser_first_serve_percentage) / 2)
      - name: average_first_serve_win_percentage
        synonyms:
          - average first serve win rate
          - avg first serve win %
          - first serve effectiveness
        description: Average first serve win percentage across all players
        expr: AVG((matches.winner_first_serve_win_percentage + matches.loser_first_serve_win_percentage) / 2)
      - name: average_games_per_match
        synonyms:
          - avg games per match
          - games per match
        description: Average number of games played per match
        expr: AVG(matches.winner_service_games + matches.loser_service_games)
      - name: average_match_duration
        synonyms:
          - average match length
          - avg match duration
        description: Average duration of matches in minutes
        expr: AVG(matches.match_duration_minutes)
      - name: average_points_per_service_game
        synonyms:
          - points per service game
          - service efficiency
          - service game efficiency
          - service game length
        description: Average number of points per service game (lower = more efficient service games)
        expr: AVG((matches.winner_service_points + matches.loser_service_points)::FLOAT / (matches.winner_service_games + matches.loser_service_games))
      - name: average_ranking_difference
        synonyms:
          - average rank difference
          - avg ranking gap
          - ranking spread
        description: Average absolute difference in rankings between players
        expr: AVG(CASE WHEN matches.winner_rank IS NOT NULL AND matches.loser_rank IS NOT NULL THEN ABS(matches.winner_rank - matches.loser_rank) ELSE NULL END)
      - name: average_second_serve_win_percentage
        synonyms:
          - avg second serve win %
          - second serve effectiveness
          - second serve win rate
        description: Average second serve win percentage across all players
        expr: AVG((matches.winner_second_serve_win_percentage + matches.loser_second_serve_win_percentage) / 2)
      - name: average_seed_difference
        synonyms:
          - average seed difference
          - avg seed gap
        description: Average absolute difference in seedings between players
        expr: AVG(CASE WHEN matches.winner_seed IS NOT NULL AND matches.loser_seed IS NOT NULL THEN ABS(matches.winner_seed - matches.loser_seed) ELSE NULL END)
      - name: average_total_points_per_match
        synonyms:
          - avg points per match
          - match intensity
          - points per match
        description: Average total points played per match
        expr: AVG(matches.winner_service_points + matches.loser_service_points)
      - name: break_point_frequency
        synonyms:
          - break opportunities per match
          - break point frequency
          - break point rate
        description: Average number of break point opportunities per match
        expr: AVG(matches.winner_break_points_faced + matches.loser_break_points_faced)
      - name: loser_break_point_save_percentage
        synonyms:
          - loser break point defense
          - loser break point save %
        description: Average break point save percentage for losers
        expr: AVG(matches.loser_break_point_save_percentage)
      - name: matches_with_age_advantage
        synonyms:
          - younger player wins
          - youth advantage matches
        description: Number of matches where the younger player won
        expr: COUNT(CASE WHEN matches.winner_age < matches.loser_age AND matches.winner_age IS NOT NULL AND matches.loser_age IS NOT NULL THEN 1 END)
      - name: max_match_duration
        synonyms:
          - longest match
          - maximal match duration
        description: Maximum duration of matches in minutes
        expr: MAX(matches.match_duration_minutes)
      - name: min_match_duration
        synonyms:
          - minimal match duration
          - shortest match
        description: Minimum duration of matches in minutes
        expr: MIN(matches.match_duration_minutes)
      - name: total_aces
        synonyms:
          - sum of aces
          - total aces
        description: Total number of aces across all matches
        expr: SUM(matches.winner_aces + matches.loser_aces)
      - name: total_matches
        synonyms:
          - match count
          - number of matches
        description: Total number of matches
        expr: COUNT(matches.match_id)
      - name: total_service_points
        synonyms:
          - sum of service points
          - total service points
        description: Total service points played across all matches
        expr: SUM(matches.winner_service_points + matches.loser_service_points)
      - name: total_upsets
        synonyms:
          - number of upsets
          - upset count
          - upsets
        description: Total number of matches where the lower-ranked player won
        expr: COUNT(CASE WHEN matches.winner_rank > matches.loser_rank AND matches.winner_rank IS NOT NULL AND matches.loser_rank IS NOT NULL THEN 1 END)
      - name: upset_percentage
        synonyms:
          - '% of upsets'
          - upset frequency
          - upset rate
        description: Percentage of matches that were upsets (lower-ranked player won)
        expr: (COUNT(CASE WHEN matches.winner_rank > matches.loser_rank AND matches.winner_rank IS NOT NULL AND matches.loser_rank IS NOT NULL THEN 1 END)::FLOAT / COUNT(CASE WHEN matches.winner_rank IS NOT NULL AND matches.loser_rank IS NOT NULL THEN 1 END)) * 100
      - name: winner_break_point_conversion_rate
        synonyms:
          - break point conversion
          - break point conversion rate
        description: Average break point conversion rate for winners
        expr: AVG(matches.winner_break_point_conversion_rate)
      - name: winner_break_point_save_percentage
        synonyms:
          - break point defense
          - break point save %
          - break point save rate
        description: Average break point save percentage for winners
        expr: AVG(matches.winner_break_point_save_percentage)
      - name: winner_first_serve_percentage
        synonyms:
          - first serve %
          - first serve percentage
        description: Average first serve percentage for winners
        expr: AVG(matches.winner_first_serve_percentage)
      - name: winner_first_serve_win_percentage
        synonyms:
          - first serve win %
          - first serve win percentage
        description: Average first serve win percentage for winners
        expr: AVG(matches.winner_first_serve_win_percentage)
    primary_key:
      columns:
        - MATCH_ID
  - name: players
    description: |
      The players table contains information about tennis players, including personal details, playing hand, country, and birthdate.
    base_table:
      database: ATP_INSIGHTS
      schema: DEFAULT
      table: PLAYERS_CLEAN
    dimensions:
      - name: country
        synonyms:
          - nationality
          - player country
        description: Country of the player
        expr: players.country
        data_type: TEXT
        unique: false
      - name: full_name
        synonyms:
          - name
          - player
          - player name
        description: Full name of the player (first name and last name combined)
        expr: CONCAT(players.first_name, ' ', players.last_name)
        data_type: TEXT
        unique: false
      - name: gender
        synonyms:
          - player gender
          - player sex
          - sex
        description: Gender of the player
        expr: players.gender
        data_type: TEXT
        unique: false
        sample_values:
          - male
          - female
      - name: generation
        synonyms:
          - age generation
          - birth generation
          - gen
          - player generation
        description: |
          Generation classification based on birth year: Gen Z (1997-2012), Millennials (1981-1996), Gen X (1965-1980), Baby Boomers (1946-1964), Silent Generation (1928-1945), Greatest Generation (before 1928)
        expr: |
          CASE
            WHEN YEAR(players.birthdate) >= 1997 AND YEAR(players.birthdate) <= 2012 THEN 'Gen Z'
            WHEN YEAR(players.birthdate) >= 1981 AND YEAR(players.birthdate) <= 1996 THEN 'Millennials'
            WHEN YEAR(players.birthdate) >= 1965 AND YEAR(players.birthdate) <= 1980 THEN 'Gen X'
            WHEN YEAR(players.birthdate) >= 1946 AND YEAR(players.birthdate) <= 1964 THEN 'Baby Boomers'
            WHEN YEAR(players.birthdate) >= 1928 AND YEAR(players.birthdate) <= 1945 THEN 'Silent Generation'
            WHEN YEAR(players.birthdate) < 1928 THEN 'Greatest Generation'
            ELSE NULL
          END
        data_type: TEXT
        unique: false
        sample_values:
          - Gen Z
          - Millennials
          - Gen X
          - Baby Boomers
          - Silent Generation
          - Greatest Generation
      - name: hand
        synonyms:
          - handedness
          - left handed
          - playing hand name
          - right handed
        description: Full name of the playing hand (Right or Left)
        expr: players.hand
        data_type: TEXT
        unique: false
        sample_values:
          - Right
          - Left
      - name: player_id
        synonyms:
          - player id
          - player identifier
        description: Unique identifier for the player
        expr: players.player_id
        data_type: TEXT
        unique: true
    facts:
      - name: player_age
        synonyms:
          - age
          - current age
        description: Current age of the player in years
        expr: DATEDIFF(year, players.birthdate, CURRENT_DATE())
        data_type: NUMBER
    primary_key:
      columns:
        - PLAYER_ID
relationships:
  - name: matches_to_winning_player
    left_table: matches
    right_table: players
    relationship_columns:
      - left_column: winner_id
        right_column: PLAYER_ID
    join_type: left_outer
    relationship_type: many_to_one
  - name: matches_to_losing_player
    left_table: matches
    right_table: players
    relationship_columns:
      - left_column: loser_id
        right_column: PLAYER_ID
    join_type: left_outer
    relationship_type: many_to_one
verified_queries:
  - name: what is the average breakpoint conversion in hard courts?
    question: what is the average breakpoint conversion in hard courts?
    sql: |-
      SELECT
        AVG(m.winner_break_point_conversion_rate) AS average_breakpoint_conversion
      FROM
        matches AS m
      WHERE
        m.tournament_surface = 'Hard'
    use_as_onboarding_question: false
    verified_by: Michael Uryukin
    verified_at: 1765710920
custom_instructions: when asked about percentages - format result with %